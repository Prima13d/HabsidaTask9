<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Admin users</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="container mt-4">

<h2>Admin panel</h2>

<!-- TABS -->
<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <button class="nav-link active"
                data-bs-toggle="tab"
                data-bs-target="#usersTab">
            Users
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link"
                data-bs-toggle="tab"
                data-bs-target="#addUserTab">
            Add user
        </button>
    </li>
</ul>

<div class="tab-content">

    <!-- ===== USERS TAB ===== -->
    <div class="tab-pane fade show active" id="usersTab">

        <table class="table table-bordered table-striped">
            <thead>
            <tr>
                <th>ID</th>
                <th>First name</th>
                <th>Family name</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.id}"></td>
                <td th:text="${user.userFirstName}"></td>
                <td th:text="${user.userFamilyName}"></td>
                <td>
                    <button class="btn btn-warning btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#editUserModal"
                            th:attr="data-id=${user.id},
                                     data-first=${user.userFirstName},
                                     data-family=${user.userFamilyName}">
                        Edit
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

    </div>

    <!-- ===== ADD USER TAB ===== -->
    <div class="tab-pane fade" id="addUserTab">

        <form th:action="@{/admin/users/add}" method="post" class="col-6">

            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>

            <div class="mb-2">
                <label>First name</label>
                <input class="form-control" name="userFirstName" required>
            </div>

            <div class="mb-2">
                <label>Family name</label>
                <input class="form-control" name="userFamilyName" required>
            </div>

            <div class="mb-2">
                <label>Username</label>
                <input class="form-control" name="username" required>
            </div>

            <div class="mb-2">
                <label>Password</label>
                <input type="password" class="form-control" name="password" required>
            </div>

            <div class="mb-3">
                <label>Role</label><br>
                <input type="radio" name="role" value="ADMIN"> ADMIN<br>
                <input type="radio" name="role" value="USER" checked> USER
            </div>

            <button class="btn btn-success">Save</button>
        </form>

    </div>
</div>

<a th:href="@{/}" class="btn btn-secondary mt-4">Back to home</a>


<div class="modal fade" id="editUserModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <form th:action="@{/admin/users/edit}" method="post">

                <div class="modal-header">
                    <h5>Edit user</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <input type="hidden" name="id" id="edit-id">

                    <input type="hidden"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}"/>

                    <div class="mb-2">
                        <label>First name</label>
                        <input class="form-control" name="userFirstName" id="edit-first">
                    </div>

                    <div class="mb-2">
                        <label>Family name</label>
                        <input class="form-control" name="userFamilyName" id="edit-family">
                    </div>

                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-success">Save</button>
                </div>

            </form>

        </div>
    </div>
</div>

<script>
    const modal = document.getElementById('editUserModal');

    modal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;

        document.getElementById('edit-id').value =
            button.getAttribute('data-id');

        document.getElementById('edit-first').value =
            button.getAttribute('data-first');

        document.getElementById('edit-family').value =
            button.getAttribute('data-family');
    });
</script>


</body>
</html>
